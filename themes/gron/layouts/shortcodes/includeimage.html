<!-- Inspired by https://eduardoboucas.com/blog/2014/12/07/including-and-managing-images-in-jekyll.html -->

{{ $img := .Get "img" }}

<!-- Checking that file exists -->
{{ if not (fileExists (path.Join (path.Dir .Page.File.Path) $img)) }}
    {{ errorf "[From %v] File could not be found %v" .Page.File.Path $img }}
{{ end }}

<!-- Image class -->
{{ if isset .Params "portrait" }}
  {{ .Scratch.Set "img_class" "img-portrait" }}
{{ else }}
  {{ if and (isset .Params "bleed") (eq (.Get "bleed") "true") }}
    {{ .Scratch.Set "img_class" "img-landscape-bleed" }}
  {{ else }}
    {{ .Scratch.Set "img_class" "img-landscape" }}
  {{ end }}
{{ end }}

{{ $img_class := .Scratch.Get "img_class" }}

<figure>
  <a href="{{ $img }}" data-lightbox="page_image">
    <img src="{{ $img }}"
      {{ with .Get "alt" }}  alt="{{.}}" {{ end }} class="{{ $img_class }}"
      {{- with .Get "style" -}}
        style="{{ . }}"
      {{- end -}}/>
  </a>
  {{ if isset .Params "caption" }}
  {{/* NOTE(agronskiy) We must utilize a newlines inside figcaption to process it as
    Markdown due to specs */}}
  <figcaption class="font-italic mt-1" markdown="span">

  {{ .Get "caption" | markdownify }}

  </span>
  {{ end }}
</figure>
